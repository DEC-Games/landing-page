<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Resource Landing Page</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    #form-container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      position: relative;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #34495e;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }
    button[type="submit"] {
      background-color: #3498db;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button[type="submit"]:hover {
      background-color: #2980b9;
    }
    button[type="submit"]:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    #links-container {
      display: none;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .resource-card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      text-align: center;
      transition: transform 0.3s;
    }
    .resource-card:hover {
      transform: translateY(-5px);
    }
    .resource-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .resource-card h3 {
      margin: 15px 0;
      color: #2c3e50;
      font-size: 18px;
    }
    .resource-card a {
      display: inline-block;
      background-color: #3498db;
      color: white;
      padding: 10px;
      text-decoration: none;
      border-radius: 5px;
      margin-bottom: 15px;
      transition: background-color 0.3s;
    }
    .resource-card a:hover {
      background-color: #2980b9;
    }
    #cookie-consent {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #2c3e50;
      color: white;
      padding: 15px;
      text-align: center;
      z-index: 1000;
      display: none;
    }
    #cookie-consent a {
      color: #3498db;
    }
    #cookie-consent button {
      margin-left: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #cookie-consent button.accept {
      background-color: #3498db;
      color: white;
    }
    #cookie-consent button.decline {
      background-color: #95a5a6;
      color: white;
    }
    .privacy-link {
      margin-top: 10px;
      font-size: 14px;
    }
    #loading-indicator {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>Digital Explorer Club</h1>

  <div id="form-container">
    <p>Plese submit your details to continue.</p>
    <form id="data-form">
      <div class="form-group">
        <label for="name">Full Name</label>
        <input type="text" id="name" name="name" required placeholder="Enter your full name">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label for="school">School</label>
        <input type="text" id="school" name="school" required placeholder="Enter your school">
      </div>
      
      <div class="form-group">
        <label for="study_year">Study Year/Grade</label>
        <select id="study_year" name="study_year" required>
          <option value="" disabled selected>Select your study year</option>
          <option value="k7">K7</option>
          <option value="k8">K8</option>
          <option value="k9">K9</option>
          <option value="k10">K10</option>
          <option value="k11">K11</option>
          <option value="k12">K12</option>
        </select>
      </div>
      <div class="form-group">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" pattern="[0-9]{9,15}" placeholder="Enter your phone number (9-15 digits)">
      </div>
      <button type="submit" id="submit-button">Submit</button>
    </form>
    <div id="loading-indicator">
      <div class="spinner"></div>
    </div>
    <p class="privacy-link">
      By submitting, you agree to our <a href="privacy.html">Privacy Policy</a>.
    </p>
  </div>

  <div id="links-container">
    <div class="resource-card">
      <img src="img/catch-the-cat.png" alt="catch-the-cat">
      <h3>Catch The Cat</h3>
      <a href="https://dec-games.github.io/phaser-catch-the-cat/" target="_blank" id="play-catch-the-cat">Play Now</a>
    </div>
    <div class="resource-card">
      <img src="img/pet.png" alt="web-pet">
      <h3>WebPet</h3>
      <a href="https://dec-games.github.io/WebPet/" target="_blank">Play Now</a>
    </div>
    <div class="resource-card">
      <img src="img/bird.png" alt="bird">
      <h3>Flappy Bird</h3>
      <a href="https://dec-games.github.io/JS-Flappy-Bird/" target="_blank" id="play-flappy-bird">Play Now</a>
    </div>
    <div class="resource-card">
      <img src="img/goblin.png" alt="globlin">
      <h3>The maze of space goblins</h3>
      <a href="https://dec-games.github.io/the-maze-of-space-goblins/" target="_blank">Play Now</a>
    </div>
    <div class="resource-card">
      <img src="img/pacman.png" alt="pacman">
      <h3>Pac-Man</h3>
      <a href="https://dec-games.github.io/pacman/" target="_blank">Play Now</a>
    </div>
    
    <div class="resource-card">
      <img src="img/dragon.png" alt="interative-dragon">
      <h3>Interactive Dragon</h3>
      <a href="https://dec-games.github.io/Interactive-Dragon/" target="_blank">Play Now</a>
    </div>
    <!-- <div class="resource-card">
      <img src="img/balloon.png" alt="balloon">
      <h3>Balloon Pop Maths</h3>
      <a href="https://dec-games.github.io/balloon-pop-maths/" target="_blank">Play Now</a>
    </div>
    <div class="resource-card">
      <img src="img/bee.png" alt="bee">
      <h3>Spelling Bee</h3>
      <a href="https://dec-games.github.io/Drag-and-Drop-Spelling-Game/" target="_blank">Play Now</a>
    </div> -->    
  </div>

  <div id="cookie-consent">
    <p>We use cookies to enhance your experience. <a href="privacy.html">Learn more</a>.</p>
    <button class="accept" onclick="acceptCookies()">Accept</button>
    <button class="decline" onclick="declineCookies()">Decline</button>
  </div>

  <script>
    // Cookie functions
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        let date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + value + expires + "; path=/";
    }

    function getCookie(name) {
      let nameEQ = name + "=";
      let ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Cookie consent functions
    function acceptCookies() {
      setCookie("cookieConsent", "accepted", 365);
      document.getElementById("cookie-consent").style.display = "none";
    }

    function declineCookies() {
      setCookie("cookieConsent", "declined", 365);
      document.getElementById("cookie-consent").style.display = "none";
    }

    // Check cookie consent and user submission on load
    window.onload = function() {
      if (!getCookie("cookieConsent")) {
        document.getElementById("cookie-consent").style.display = "block";
      }
      if (getCookie("userSubmitted") && getCookie("cookieConsent") === "accepted") {
        document.getElementById("form-container").style.display = "none";
        document.getElementById("links-container").style.display = "grid";
      }
    };

    // Handle form submission
    document.getElementById("data-form").addEventListener("submit", function(event) {
      event.preventDefault();
      if (getCookie("cookieConsent") !== "accepted") {
        alert("Please accept cookies to proceed.");
        return;
      }

      const submitButton = document.getElementById("submit-button");
      const loadingIndicator = document.getElementById("loading-indicator");

      // Show loading indicator and disable button
      submitButton.disabled = true;
      loadingIndicator.style.display = "flex";

      const formData = {
        name: this.querySelector('#name').value,
        email: this.querySelector('#email').value,
        school: this.querySelector('#school').value,
        study_year: this.querySelector('#study_year').value,
        phone: this.querySelector('#phone').value
      };

      fetch('https://submitstudentdata-gksuylu43a-uc.a.run.app', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      })
      .then(response => {
        // Hide loading indicator and re-enable button
        submitButton.disabled = false;
        loadingIndicator.style.display = "none";
        if (response.ok) {
          setCookie("userSubmitted", "true", 30);
          document.getElementById("form-container").style.display = "none";
          document.getElementById("links-container").style.display = "grid";
          // Save them to localStorage
          localStorage.setItem('userData', JSON.stringify(formData));
          addParamToGame();
        } else {
          alert("Error submitting form. Please try again.");
        }
        return response.json() })
      .then(data => {
        // // Hide loading indicator and re-enable button
        // submitButton.disabled = false;
        // loadingIndicator.style.display = "none";

        // if (data.status === 'OK') {
        //   setCookie("userSubmitted", "true", 30);
        //   document.getElementById("form-container").style.display = "none";
        //   document.getElementById("links-container").style.display = "grid";
        //   // Save them to localStorage
        //   localStorage.setItem('userData', JSON.stringify(formData));
        //   addParamToGame();
        // } else {
        //   alert("Error submitting form. Please try again.");
        // }
      })
      .catch(error => {
        // Hide loading indicator and re-enable button
        submitButton.disabled = false;
        loadingIndicator.style.display = "none";
        console.error("Error:", error);
        alert("Error submitting form. Please try again.");
      });
    });

    // This script should run after the HTML has loaded
    document.addEventListener('DOMContentLoaded', () => {
      addParamToGame();
    });

    function addParamToGame() {
      // 1. Retrieve the saved data from localStorage
      const userData = JSON.parse(localStorage.getItem('userData'));
      
      // 2. Find the link by its new ID
      const playLink = document.getElementById('play-catch-the-cat');
      addParamToPlayLink(playLink, userData)
      const playLink2 = document.getElementById('play-flappy-bird');
      addParamToPlayLink(playLink2, userData)
    }

    function addParamToPlayLink(playLink, userData) {
      // 3. Check if the link and some user data exist
      if (playLink && userData) {
        // Get the link's original destination
        const baseURL = playLink.href;

        // Safely build the URL parameters
        const params = new URLSearchParams();
        if (userData.name) {
          params.append('name', userData.name);
        }
        if (userData.email) {
          params.append('email', userData.email);
        }

        // 4. Update the link's href attribute with the new parameters
        playLink.href = `${baseURL}?${params.toString()}`;
      }
    }
  </script>
</body>
</html>